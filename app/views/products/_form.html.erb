<%= form_with model: [@product.category, @product], local: true do |form| %>
  <div class="d-inline-flex">
    <div class="d-flex flex-column my-3">
      <%= form.label :title %>
      <div class="d-inline-flex ">
        <%= form.text_field :title %>
      </div>
      <% @product.errors.full_messages_for(:title).each do |message| %>
        <div class="bg-warning border rounded-3 my-1 "><%= message %></div>
      <% end %>
    </div>

    <div class="d-flex flex-column my-3">
      <%= form.label :price %>
      <div class="d-inline-flex">
        <%= form.text_field :price %>
      </div>
      <% @product.errors.full_messages_for(:price).each do |message| %>
        <div class="bg-warning border rounded-3 my-1"><%= message %></div>
      <% end %>
    </div>
  </div>

  <div class="my-3">
    <%= form.label :features %>
    <div id="featuresList" class="d-flex flex-column">
      <%= form.fields_for :features do |subform| %>
        <%= tag.div id: "feature#{subform.index}", class: "d-inline-flex" do %>
          <%= subform.text_field :name, class: "mr-1" %>
          <%= subform.text_field :value, class: "mr-1" %>
          <%= tag.div id: "#{subform.index}",class: "destroyNode border rounded-3 bg-white p-1" do %>
            <% features_ids = @product.features.map(&:id) %>
            <% if features_ids.compact.any?(subform.object.id) %>
              <%= link_to "X", category_product_feature_path(@product.category, @product, @product.features[subform.index]),class: 'm-2 text-dark', method: :delete %>
            <% else %>
              <a class='text-dark'>X</a>
            <% end %>
          <% end %>
        <% end %>
        <% subform.object.errors.full_messages_for(:name).each do |message| %>
          <div class="bg-warning border rounded-3 my-1"><%= message %></div>
        <% end %>
        <% subform.object.errors.full_messages_for(:value).each do |message| %>
          <div class="bg-warning border rounded-3 my-1"><%= message %></div>
        <% end %>
      <% end %>
    </div>
  </div>

  <div id="addFeature" class="my-3 border rounded-3 p-2 bg-white">
    <p>Add feature</p>
  </div>

  <div class="my-3">
    <%= form.submit %>
  </div>
<% end %>
